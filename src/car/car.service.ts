import { Injectable, NotFoundException } from '@nestjs/common';
import { Interval, SchedulerRegistry } from '@nestjs/schedule';
import { Car } from './entities/car.entity';

@Injectable()
export class CarService {
  private carArr: Car[] = [
    {
      custId: 'test1234', // 고객사ID
      carList: [
        '01가1001',
        '01가1002',
        '01가1003',
        '01가1004',
        '01가1005',
        '01가1006',
        '01가1007',
        '01가1008',
        '01가1009',
        '01가1010',
        '01가1011',
        '01가1012',
        '01가1013',
        '01가1014',
        '01가1015',
        '01가1016',
      ], // 차량 번호 입력
      lat_lon: new Map([
        [
          '01가1001', // carList 첫 번째 차량
          [
            // 위도, 경도
            [35.1104359, 126.8758168],
            [35.1101437, 126.8758168],
            [35.1098723, 126.8757785],
            [35.1096531, 126.8757657],
            [35.109413, 126.8757147],
            [35.1091416, 126.8756126],
            [35.1089224, 126.8755233],
            [35.1087345, 126.8753064],
            [35.1085362, 126.8751278],
            [35.1083901, 126.8749109],
            [35.1082753, 126.874745],
            [35.1082231, 126.8745026],
            [35.1080665, 126.8741836],
            [35.1080665, 126.8741836],
            [35.1079517, 126.8738519],
            [35.1078995, 126.8734691],
            [35.1078056, 126.8731629],
            [35.1077117, 126.872895],
            [35.1076804, 126.8725633],
            [35.1078474, 126.8724867],
            [35.1080144, 126.8724357],
            [35.1082232, 126.872474],
            [35.1084111, 126.8728312],
            [35.1085259, 126.873265],
            [35.1086882, 126.873721],
            [35.1088111, 126.8740751],
            [35.1090217, 126.8744506],
            [35.1092499, 126.8747403],
            [35.1095746, 126.8750192],
            [35.1098116, 126.8752016],
            [35.110031, 126.8754054],
            [35.1102943, 126.8755771],
            [35.1103908, 126.8756951],
          ],
        ],
        [
          '01가1002', // carList 두 번째 차량
          [
            [35.1104359, 126.8758168],
            [35.1101437, 126.8758168],
            [35.1098723, 126.8757785],
          ],
        ],
        [
          '01가1003', // carList 세 번째 차량
          [
            [3, 126.8747403],
            [3, 126.8750192],
            [3, 126.8752016],
            [3, 126.8754054],
            [3, 126.8755771],
            [3, 126.8756951],
          ],
        ],
        [
          '01가1004', // 조선대학교 01가1004 // 1
          [
            [35.1421522, 126.9278016],
            [35.141744, 126.9283548],
            [35.1420278, 126.9287479],
            [35.1422735, 126.9288552],
            [35.1425586, 126.9289786],
            [35.1428832, 126.9290805],
            [35.1431727, 126.9293004],
            [35.1433218, 126.9296705],
            [35.1433832, 126.9301158],
            [35.1434534, 126.9307864],
            [35.1434271, 126.9314355],
            [35.1431376, 126.9316286],
            [35.1427647, 126.9316179],
            [35.1423655, 126.931693],
            [35.1420804, 126.9317037],
            [35.1417031, 126.9318056],
            [35.1412776, 126.9318324],
            [35.1408082, 126.9318753],
            [35.1399045, 126.9320255],
            [35.1393649, 126.9321274],
            [35.1389789, 126.9327014],
            [35.1391675, 126.9336134],
            [35.1392114, 126.9344395],
            [35.139751, 126.9347184],
            [35.1402555, 126.9348418],
            [35.1411723, 126.9347935],
            [35.1419531, 126.9346218],
            [35.142769, 126.9342838],
            [35.1435147, 126.9342731],
            [35.1441507, 126.9340907],
            [35.1447253, 126.9338332],
            [35.1442298, 126.9336832],
            [35.1434665, 126.9337154],
            [35.1429357, 126.9337261],
            [35.1430454, 126.9333184],
            [35.1434709, 126.9326157],
            [35.1434797, 126.9317896],
            [35.1435236, 126.9307757],
            [35.1434095, 126.9298047],
            [35.1429665, 126.9289142],
            [35.142348, 126.9286835],
          ],
        ],
        [
          '01가1005', // 호남대학교 01가1005 // 2
          [
            [35.1502811, 126.7689602],
            [35.1504687, 126.7688981],
            [35.1505039, 126.7690845],
            [35.1505567, 126.7693999],
            [35.1506153, 126.7700355],
            [35.1508861, 126.7701572],
            [35.1514111, 126.7700761],
            [35.1516764, 126.7697584],
            [35.151378, 126.7694002],
            [35.1512786, 126.7689676],
            [35.151157, 126.7682782],
            [35.151157, 126.7679538],
            [35.1514554, 126.7678119],
            [35.1514333, 126.7673185],
            [35.1511349, 126.7667846],
            [35.1507923, 126.766494],
            [35.1504165, 126.7662912],
            [35.150002, 126.7661222],
            [35.1497699, 126.7664399],
            [35.1498804, 126.766913],
            [35.150212, 126.7674875],
            [35.1503667, 126.7684202],
            [35.1504496, 126.7687649],
          ],
        ],
        [
          '01가1006', // 광주대학교 01가1006 // 3
          [
            [35.1075742, 126.8970358],
            [35.1079092, 126.8969656],
            [35.1082633, 126.8968954],
            [35.1082154, 126.8960764],
            [35.1078134, 126.8954797],
            [35.10722, 126.895351],
            [35.1064639, 126.8951053],
            [35.1060236, 126.8950585],
            [35.1057939, 126.8956786],
            [35.1051622, 126.8958307],
            [35.1044156, 126.8958892],
            [35.1039849, 126.8953042],
            [35.103602, 126.8947309],
            [35.1034393, 126.894064],
            [35.1031904, 126.8928238],
            [35.1026161, 126.8924845],
            [35.1026257, 126.8933854],
            [35.102865, 126.8943214],
            [35.1032287, 126.8947777],
            [35.1038222, 126.8950702],
            [35.1042912, 126.89617],
            [35.1048081, 126.8967433],
            [35.1056313, 126.8967316],
            [35.1065502, 126.896755],
            [35.1070383, 126.8969773],
          ],
        ],
        [
          '01가1007', // 광주보건대학교 01가1007 // 4
          [
            [35.1923112, 126.8453706],
            [35.1922323, 126.8446732],
            [35.1919605, 126.8443191],
            [35.1916712, 126.8443513],
            [35.1912942, 126.8443728],
            [35.1909347, 126.8444479],
            [35.1904086, 126.8448556],
            [35.1899527, 126.8451131],
            [35.1896634, 126.8453169],
            [35.189567, 126.845907],
            [35.1899791, 126.8456817],
            [35.1904438, 126.8456495],
            [35.1908471, 126.8455208],
            [35.1911364, 126.8454457],
            [35.1916274, 126.8453813],
            [35.1919869, 126.8453706],
          ],
        ],
        [
          '01가1008', // 남부대학교 01가1008 // 5
          [
            [35.207559, 126.8427143],
            [35.2075514, 126.8421664],
            [35.2072707, 126.8419157],
            [35.2067927, 126.8418971],
            [35.206383, 126.8418971],
            [35.2061478, 126.8415442],
            [35.2061402, 126.840727],
            [35.206125, 126.8401605],
            [35.2065803, 126.8401976],
            [35.2071873, 126.8401419],
            [35.2075818, 126.8401698],
            [35.2079915, 126.8401605],
            [35.2081357, 126.8397519],
            [35.2080902, 126.8390554],
            [35.2075211, 126.8389904],
            [35.2069748, 126.8389718],
            [35.2065271, 126.8389997],
            [35.2063753, 126.8384147],
            [35.2059504, 126.8382383],
            [35.2054951, 126.8382476],
            [35.2050626, 126.8382476],
            [35.204797, 126.8386655],
            [35.2043341, 126.8392505],
            [35.2041975, 126.8399563],
            [35.2049259, 126.8401235],
            [35.2055784, 126.8401235],
            [35.2061095, 126.8401328],
            [35.2061474, 126.840755],
            [35.2061402, 126.8415814],
          ],
        ],
        [
          '01가1009', // 국립아시아문화전당 01가1009 // 6
          [
            [35.1473664, 126.9189713],
            [35.1480353, 126.918649],
            [35.14839, 126.9179425],
            [35.1487954, 126.9174095],
            [35.1492312, 126.9167773],
            [35.1495555, 126.9162319],
            [35.1499812, 126.9156989],
            [35.150042, 126.9151287],
            [35.149444, 126.9144345],
            [35.1486737, 126.913604],
            [35.1480453, 126.9128479],
            [35.1475487, 126.9123397],
            [35.1471737, 126.911943],
            [35.1465047, 126.912476],
            [35.1457851, 126.9131082],
            [35.145106, 126.9137652],
            [35.1448121, 126.914261],
            [35.1452581, 126.9152403],
            [35.1456635, 126.9162443],
            [35.1462412, 126.9171368],
            [35.1466162, 126.9181037],
            [35.1469912, 126.9188102],
          ],
        ],
        [
          '01가1010', // 유스퀘어 01가1010 // 7
          [
            [35.1612922, 126.8805369],
            [35.1613496, 126.8792967],
            [35.1614453, 126.8782203],
            [35.161407, 126.8767461],
            [35.1605079, 126.8769801],
            [35.1595514, 126.8770269],
            [35.1587288, 126.8768163],
            [35.1578488, 126.8769567],
            [35.1574088, 126.8769333],
            [35.1574279, 126.8776587],
            [35.1573514, 126.8788755],
            [35.1572749, 126.8799519],
            [35.1571984, 126.8810985],
            [35.1571601, 126.8821515],
            [35.1578871, 126.8830173],
            [35.158901, 126.8829939],
            [35.1601062, 126.8832045],
            [35.1609862, 126.8832747],
            [35.161254, 126.8817303],
            [35.1612923, 126.8803263],
          ],
        ],
        [
          '01가1011', // 광주 송정역 01가1011 // 8
          [
            [35.1374376, 126.7918564],
            [35.1381142, 126.7920403],
            [35.1387478, 126.7924474],
            [35.1394029, 126.7928808],
            [35.1399399, 126.7933536],
            [35.1403587, 126.7936294],
            [35.1408634, 126.7941416],
            [35.1413037, 126.7946406],
            [35.140756, 126.7951134],
            [35.1402727, 126.7954811],
            [35.1395854, 126.7960983],
            [35.1387048, 126.7968206],
            [35.1382249, 126.7974075],
            [35.1376928, 126.7981603],
            [35.1373172, 126.7986451],
            [35.1366494, 126.7986068],
            [35.1361173, 126.7981475],
            [35.13546, 126.7976499],
            [35.1350218, 126.7968333],
            [35.1354809, 126.7957998],
            [35.1358357, 126.7950725],
            [35.1362218, 126.7943325],
            [35.1366079, 126.7933118],
            [35.1370148, 126.7926356],
            [35.1373696, 126.7917935],
          ],
        ],
        [
          '01가1012', // 동강대학교 01가1012 // 9
          [
            [35.1700592, 126.9258629],
            [35.1696575, 126.9257225],
            [35.169141, 126.9262841],
            [35.168768, 126.926015],
            [35.1688541, 126.9255704],
            [35.1683855, 126.9257693],
            [35.1681368, 126.9267053],
            [35.1675821, 126.9270797],
            [35.1674195, 126.926366],
            [35.1675343, 126.9257342],
            [35.1680699, 126.9255704],
            [35.1686342, 126.9255353],
            [35.1691315, 126.9252077],
            [35.1694567, 126.9246695],
            [35.1691698, 126.9242249],
            [35.1693324, 126.9234644],
            [35.1688064, 126.923324],
            [35.1682995, 126.9233825],
            [35.1678882, 126.9234059],
            [35.1680317, 126.9239792],
            [35.1686821, 126.9240728],
            [35.1690838, 126.9241664],
            [35.1694281, 126.9245525],
            [35.1689977, 126.9253598],
            [35.1687108, 126.9259916],
            [35.1689499, 126.9263075],
            [35.1693707, 126.9262958],
            [35.1697246, 126.9258161],
          ],
        ],
        [
          '01가1013', // 서영대학교 01가1013 // 10
          [
            [35.1763791, 126.8709354],
            [35.1764417, 126.8704378],
            [35.176546, 126.8698126],
            [35.1762749, 126.8696085],
            [35.1762332, 126.8690854],
            [35.1765252, 126.8687664],
            [35.1765669, 126.8682943],
            [35.1762019, 126.8680264],
            [35.175597, 126.8681795],
            [35.17494, 126.8683326],
            [35.174867, 126.8688302],
            [35.1748357, 126.8694809],
            [35.1748148, 126.8702464],
            [35.1753258, 126.8705016],
            [35.1759411, 126.8706547],
          ],
        ],
        [
          '01가1014', // 광주교육대 01가1014 // 11
          [
            [35.1636762, 126.9246423],
            [35.1640139, 126.9247335],
            [35.1644261, 126.9249159],
            [35.164869, 126.9250822],
            [35.1651672, 126.9251949],
            [35.1651672, 126.9254899],
            [35.1650926, 126.9258761],
            [35.1649786, 126.9263374],
            [35.1651979, 126.926493],
            [35.1654259, 126.9266808],
            [35.1656145, 126.9269007],
            [35.1658732, 126.9270777],
            [35.1660749, 126.9275069],
            [35.1659915, 126.9280491],
            [35.1657516, 126.9285531],
            [35.1654804, 126.929089],
            [35.1650215, 126.9289359],
            [35.1646721, 126.9286807],
            [35.1643488, 126.9284255],
            [35.164015, 126.9281703],
            [35.1637334, 126.927896],
            [35.1633944, 126.9276727],
            [35.1632692, 126.927258],
            [35.1631336, 126.9269263],
            [35.1631284, 126.9263203],
            [35.1633214, 126.925593],
            [35.1634935, 126.9251401],
            [35.16365, 126.9246361],
          ],
        ],
        [
          '01가1015', // 광주과학기술원 01가1015 // 12
          [
            [35.2257415, 126.841136],
            [35.2256099, 126.8419417],
            [35.2255998, 126.842859],
            [35.225963, 126.8434351],
            [35.2266515, 126.8437822],
            [35.2272996, 126.8441293],
            [35.2279071, 126.8443896],
            [35.2284032, 126.8447119],
            [35.2289803, 126.8449474],
            [35.2294258, 126.84434],
            [35.2296992, 126.8435839],
            [35.2299928, 126.8425551],
            [35.2302763, 126.8417494],
            [35.2304889, 126.8410924],
            [35.2299421, 126.8403859],
            [35.2291625, 126.840014],
            [35.2284335, 126.8396421],
            [35.2277247, 126.8391835],
            [35.2269855, 126.8387992],
            [35.2266716, 126.8393322],
            [35.2261856, 126.8400016],
            [35.2259021, 126.8407329],
          ],
        ],
        [
          '01가1016',
          [
            [35.1640971, 126.7995769],
            [35.1641482, 126.7990225],
            [35.1641035, 126.7984603],
            [35.1638985, 126.7978103],
            [35.1637619, 126.7972717],
            [35.1636404, 126.7967888],
            [35.1635569, 126.7960459],
            [35.1630938, 126.7959345],
            [35.1626079, 126.7959809],
            [35.1621448, 126.7961109],
            [35.1621676, 126.7967424],
            [35.1622587, 126.7972624],
            [35.1626155, 126.797476],
            [35.1629799, 126.7975689],
            [35.1633671, 126.7975596],
            [35.1637011, 126.7976803],
            [35.1639364, 126.7982096],
            [35.1640123, 126.7987111],
            [35.1640275, 126.799129],
          ],
        ],
      ]),
    }, // index : carArr[0]
    {
      custId: 'test2222',
      carList: ['02가1001', '02가1002'],
      lat_lon: new Map([
        [
          '02가1001',
          [
            [35.1104359, 126.8758168],
            [35.1101437, 126.8758168],
            [35.1098723, 126.8757785],
            [35.1096531, 126.8757657],
            [35.109413, 126.8757147],
          ],
        ],
        [
          '02가1002',
          [
            [35.1104359, 126.8758168],
            [35.1101437, 126.8758168],
            [35.1098723, 126.8757785],
            [35.1096531, 126.8757657],
            [35.109413, 126.8757147],
          ],
        ],
      ]),
    }, // index : carArr[1]
    {
      custId: 'test3333',
      carList: ['03가1001'],
      lat_lon: new Map([
        [
          '03가1001',
          [
            [33333, 126.8758168],
            [33333, 126.8758168],
            [33333, 126.8757785],
            [33333, 126.8757657],
            [33333, 126.8757147],
          ],
        ],
      ]),
    }, // index : carArr[2]
  ];
  @Interval(5000) // 5초
  interval() {
    for (let i = 0; i < this.carArr.length; i++) {
      for (let j = 0; j < this.carArr[i].carList.length; j++) {
        const tempArr = this.carArr[i].lat_lon.get(
          this.carArr[i].carList[j],
        )[0];
        this.carArr[i].lat_lon.get(this.carArr[i].carList[j]).shift();
        this.carArr[i].lat_lon.get(this.carArr[i].carList[j]).push(tempArr);

        // 전체 차량 위도 경도 console.log
        console.log(
          `${i + 1}-${j + 1} : ${
            this.carArr[i].lat_lon.get(this.carArr[i].carList[j])[0]
          }`,
        );
      }
    }
  }

  async getCarLocation(data) {
    const carInfo = [];
    let rsltCd = '301';
    if (!data.custId || !data.carList || !data.carList[0].carNum) {
      return {
        rsltCd: rsltCd,
        infoList: carInfo,
      };
    }
    await this.carArr.forEach((car) => {
      if (car.custId === data.custId) {
        rsltCd = '000';
        for (let i = 0; i < car.carList.length; i++) {
          for (let j = 0; j < data.carList.length; j++) {
            if (car.carList[i] === data.carList[j].carNum) {
              carInfo.push({
                carNum: car.carList[i],
                gpsLat: car.lat_lon.get(car.carList[i])[0][0],
                gpsLong: car.lat_lon.get(car.carList[i])[0][1],
              });
            }
          }
        }
      }
    });

    if (carInfo.length <= 0) {
      rsltCd = '302';
    }

    return {
      rsltCd: rsltCd,
      infoList: carInfo,
    };
  }
}
